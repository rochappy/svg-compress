const{app:app,BrowserWindow:BrowserWindow,ipcMain:ipcMain,dialog:dialog}=require("electron");const path=require("path");const Svgo=require("svgo");const{exec:exec,execSync:execSync,spawn:spawn,spawnSync:spawnSync}=require("child_process");const config=require("./config");const fs=require("fs-extra");const glob=require("glob");let mainWindow;function globPromise(pattern,options){return new Promise((resolve,reject)=>{glob(pattern,(err,files)=>{if(err){reject(err)}else{resolve(files)}})})}function handlerSvgs(event,svgs,outDir){svgo=new Svgo(config);const handlerSvg=svgs.map(svgFile=>{const svgCont=fs.readFileSync(svgFile,"utf-8");const base=path.parse(svgFile).base;return svgo.optimize(svgCont,{path:svgFile}).then(result=>{fs.outputFile(`${outDir}/${base}`,result.data);const resultData={file:svgFile,content:result.data,total:svgs.length};event.sender.send("outProcess",resultData);return resultData})});return Promise.all(handlerSvg).then(values=>{event.sender.send("outDone",{total:values.length})})}function createWindow(){mainWindow=new BrowserWindow({width:1e3,height:600,webPreferences:{preload:path.join(__dirname,"preload.js")}});mainWindow.loadFile("index.html");mainWindow.on("closed",function(){mainWindow=null})}app.on("ready",createWindow);app.on("window-all-closed",function(){if(process.platform!=="darwin")app.quit()});app.on("activate",function(){if(mainWindow===null)createWindow()});ipcMain.on("open-dialog",function(event,opts){dialog.showOpenDialog(opts).then(result=>{event.sender.send("selectedItem",result.filePaths)})});ipcMain.on("outsvg",(event,data)=>{if(data.type=="file"){handlerSvgs(event,data.content,data.outputDir)}else{globPromise(`${data.content[0]}/**/*.svg`).then(svgs=>{handlerSvgs(event,svgs,data.outputDir)})}});